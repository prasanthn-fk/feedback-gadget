<?xml version="1.0" encoding="UTF-8" ?>

<Module>
  <ModulePrefs title="Help your Peer">
    <Require feature="minimessage"/> 
  </ModulePrefs>

  <Content type="html">

  <![CDATA[
  <!-- ALm6fM09vrVPTZagpMHziQNp2+U3m4R4ncXa2q6AR/hnbga4WWkJ29aays8w15ah/7L4Y/u4B7ek7lJ49sdmo9s970ZgUhVxhf1lsAlw6nBHTx3VR+DJwcj8WaxMBPnr7d5X75oB7T800eamC3KyfL6wsYRa3HUmaOI9j/+OQMIkmHU7xaKllj/jZ3Sfki2KBoDXQM7dw3Wx -->

   <script type="text/javascript">

       
      
       function giveFeedback (form) {
          var recepient = form.name.value;
          var listening = form.listening.value;
          var punctuality = form.punctuality.value;

          var url = "https://script.google.com/a/macros/flipkart.com/s/AKfycbymlveo5YmvUxmXFl20u2p2xZ2MUIvGBcVhho3Kr2QtGcD_s9I5/exec";

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          var params = {};
          params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT; 
          params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.GET;  
          params['recepient'] = recepient;
          params['listening'] = listening;
          params['punctuality'] = punctuality;
          params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.SIGNED; 
          params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME] = "google";
          params[gadgets.io.RequestParameters.OAUTH_USE_TOKEN] = "always";
          
          // var encoded_params = gadgets.io.encodeValues(params);
          
          makeCachedRequest(url, callback, params, 0);
          
       };

        function callback(response) { 
          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          msg.createDismissibleMessage(obj.text + "\n" + obj.errors);

            if (response.oauthApprovalUrl) {
                msg.createDismissibleMessage('OAuth URL:' + response.oauthApprovalUrl);
            } else if (oauthError) {
                msg.createDismissibleMessage('OAuth error: ' + response.oauthError + ': ' + response.oauthErrorText);
            }
            if (response.data || response.text) {
                msg.createDismissibleMessage(response.text);
            }
       };

      

       function makeCachedRequest(url, callback, params, refreshInterval) {
          var ts = new Date().getTime();
          var sep = "?";
          if (refreshInterval && refreshInterval > 0) {
            ts = Math.floor(ts / (refreshInterval * 1000));
          }
          if (url.indexOf("?") > -1) {
            sep = "&";
          }
          url = [ url, sep, "nocache=", ts ].join("");
          gadgets.io.makeRequest(url, callback, params);
       }
      

     </script>

    <FORM NAME="myform" ACTION="" METHOD="GET">Etiquette   Feedback for <BR>
       <INPUT TYPE="text" NAME="name" VALUE="prasanthn@flipkart.com"><P>
       <label for="listening">Listening Habits:</label>
       <select name="listening">
          <option value="good">Good</option>
          <option value="bad">Bad</option>
          <option value="ugly">Ugly</option>
       </select>
       <br/>
       <label for="punctuality">Punctuality:</label>
       <select name="punctuality">
          <option value="most_often_late">Most often late</option>
          <option value="sometimes_late">Sometimes late</option>
          <option value="prompt">Prompt</option>
       </select>
     </p>
       <INPUT TYPE="button" NAME="button" Value="Give Feedback" onClick="giveFeedback(this.form)">
     </FORM>
     <div id="content_div"></div>
     
  ]]>
  </Content>
</Module>