<?xml version="1.0" encoding="UTF-8" ?>

<Module>
  <ModulePrefs title="Help your Peer4">
    <Require feature="minimessage"/> 
    
  </ModulePrefs>

  <Content type="html">

  <![CDATA[


   <script type="text/javascript">

       
      
       function giveFeedback (form) {
          var recepient = form.name.value;
          var listening = form.listening.value;
          var punctuality = form.punctuality.value;

          var url = "https://script.google.com/macros/s/AKfycbzHfDhyOn5MmrZGDcSNAL8d7pfIDW2HPAKFSmBzbA7ELfBbcx4/exec";

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          var params = {};
          params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT; 
          params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.POST;  
          params["recepient"] = recepient;
          params["listening"] = listening;
          params["punctuality"] = punctuality;
          params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.SIGNED; 

//           params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME] = "google";
          
          
          var encoded_params = gadgets.io.encodeValues(params);
          
          console.log("About to invoke url" + url + " with params " + encoded_params);
          
          makeCachedRequest(url, callback, encoded_params, 0);
          
       };

        function callback(response) { 
          
          document.getElementById('content_div').innerHTML = response.text;

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          msg.createDismissibleMessage(response.text);

            if (response.oauthApprovalUrl) {
                msg.createDismissibleMessage('OAuth URL:' + response.oauthApprovalUrl);
            } else if (response.oauthError) {
                msg.createDismissibleMessage('OAuth error: ' + response.oauthError + ': ' + response.oauthErrorText);
            }
       };

      

       function makeCachedRequest(url, callback, params, refreshInterval) {
          var ts = new Date().getTime();
          var sep = "?";
          if (refreshInterval && refreshInterval > 0) {
            ts = Math.floor(ts / (refreshInterval * 1000));
          }
          if (url.indexOf("?") > -1) {
            sep = "&";
          }
          url = [ url, sep, "nocache=", ts ].join("");
          gadgets.io.makeRequest(url, callback, params);
       }
      

     </script>

    <FORM NAME="myform" ACTION="" METHOD="POST">Etiquette   Feedback for <BR>
       <INPUT TYPE="text" NAME="name" VALUE="prasanthn@flipkart.com"><P>
       <label for="listening">Listening Habits:</label>
       <select name="listening">
          <option value="good">Good</option>
          <option value="bad">Bad</option>
          <option value="ugly">Ugly</option>
       </select>
       <br/>
       <label for="punctuality">Punctuality:</label>
       <select name="punctuality">
          <option value="most_often_late">Most often late</option>
          <option value="sometimes_late">Sometimes late</option>
          <option value="prompt">Prompt</option>
       </select>
     </p>
       <INPUT TYPE="button" NAME="button" Value="Give Feedback" onClick="giveFeedback(this.form)">
     </FORM>
     <div id="content_div" style="border:4px;">Hi</div>
     
  ]]>
  </Content>
</Module>