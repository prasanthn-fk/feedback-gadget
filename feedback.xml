<?xml version="1.0" encoding="UTF-8" ?>

<Module>
  <ModulePrefs title="Help your Peer3">
    <Require feature="minimessage"/> 
    <Require feature="opensocial-0.8" />

  </ModulePrefs>

  <Content type="html">

  <![CDATA[
  <!-- ALm6fM2kFsEPoXvFhDw6/6Jvub0idJMTCgmYz8fc0dF4NDDUjtJSDZmRwkN7cWtYaZe5SbW7/A5/FRK0QK1hSy4CsTJ3G9icKsJ2E+0tCOWtRTSIcLb/k008ApG2e73SEG+NuteQMy79HE1RSxMM1CsUoxy/fZGXwP9r/N5kH4tGjxmcai2oMeA= -->

    <script src="http://gadget-doc-examples.googlecode.com/svn/trunk/opensocial-gadgets/popup.js"></script>

    <style>
  #main {
    margin: 0px;
    padding: 0px;
    font-size: small;
  }
  </style>


   <script type="text/javascript">

       
      
       function giveFeedback (form) {
          var recepient = form.name.value;
          var listening = form.listening.value;
          var punctuality = form.punctuality.value;

          var url = "https://script.google.com/a/macros/flipkart.com/s/AKfycbymlveo5YmvUxmXFl20u2p2xZ2MUIvGBcVhho3Kr2QtGcD_s9I5/exec";

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          var params = {};
          params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT; 
          params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.GET;  
          params['recepient'] = recepient;
          params['listening'] = listening;
          params['punctuality'] = punctuality;
          params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.SIGNED; 
//           params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME] = "google";
          
          console.log("About to invoke url" + url);
          
          // var encoded_params = gadgets.io.encodeValues(params);
          
          makeCachedRequest(url, callback, params, 0);
          
       };

        function callback(response) { 
          
          document.getElementById('content_div').innerHTML = response.text;

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          msg.createDismissibleMessage(response.text);

            if (response.oauthApprovalUrl) {
                msg.createDismissibleMessage('OAuth URL:' + response.oauthApprovalUrl);
            } else if (response.oauthError) {
                msg.createDismissibleMessage('OAuth error: ' + response.oauthError + ': ' + response.oauthErrorText);
            }
       };

      

       function makeCachedRequest(url, callback, params, refreshInterval) {
          var ts = new Date().getTime();
          var sep = "?";
          if (refreshInterval && refreshInterval > 0) {
            ts = Math.floor(ts / (refreshInterval * 1000));
          }
          if (url.indexOf("?") > -1) {
            sep = "&";
          }
          url = [ url, sep, "nocache=", ts ].join("");
          gadgets.io.makeRequest(url, callback, params);
       }
      

     </script>

    <FORM NAME="myform" ACTION="" METHOD="GET">Etiquette   Feedback for <BR>
       <INPUT TYPE="text" NAME="name" VALUE="prasanthn@flipkart.com"><P>
       <label for="listening">Listening Habits:</label>
       <select name="listening">
          <option value="good">Good</option>
          <option value="bad">Bad</option>
          <option value="ugly">Ugly</option>
       </select>
       <br/>
       <label for="punctuality">Punctuality:</label>
       <select name="punctuality">
          <option value="most_often_late">Most often late</option>
          <option value="sometimes_late">Sometimes late</option>
          <option value="prompt">Prompt</option>
       </select>
     </p>
       <INPUT TYPE="button" NAME="button" Value="Give Feedback" onClick="giveFeedback(this.form)">
     </FORM>
     <div id="content_div" style="border:4px;">Hi</div>
     
  ]]>
  </Content>
</Module>