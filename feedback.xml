<?xml version="1.0" encoding="UTF-8" ?>

<Module>
  <ModulePrefs title="Help your Peer">
    <Require feature="minimessage"/> 
  </ModulePrefs>

  <Content type="html">
  <!-- ALm6fM3DSQU3scXIwICPpBsG0lOg21Z8di9Ca2ZzQ9dQGNjTjnruW1QlzT8mS/XreJn7CLQuSh+fObEdJVtgsn6IL0iVgm5o0sNDArc/x0bdZ+3+obYybCMrDQJhS+nN1IP/uaEI1dK3/P4uZULgVqMcLygGFlht3cVkgqlmsJSHzEp42nticxU4JOJVl3YpF5UvZ3tDf/zS -->

  <![CDATA[
     <script type="text/javascript">

       
      
       function giveFeedback (form) {
          var recepient = form.name.value;
          var listening = form.listening.value;
          var punctuality = form.punctuality.value;

          https://script.google.com/a/macros/flipkart.com/s/AKfycbymlveo5YmvUxmXFl20u2p2xZ2MUIvGBcVhho3Kr2QtGcD_s9I5/exec
          
          var url = "https://script.google.com/a/macros/flipkart.com/s/AKfycbymlveo5YmvUxmXFl20u2p2xZ2MUIvGBcVhho3Kr2QtGcD_s9I5/exec";

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          var params = {};
          params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT; 
          params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.GET;  
          params['recepient'] = recepient;
          params['listening'] = listening;
          params['punctuality'] = punctuality;
          params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.OAUTH; 
          params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME] = "google";
          params[gadgets.io.RequestParameters.OAUTH_USE_TOKEN] = "always";
          
          // var encoded_params = gadgets.io.encodeValues(params);
          
          makeCachedRequest(url, callback, params, 0);
          
       };

        function callback(response) { 
          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          msg.createDismissibleMessage(obj.text + "\n" + obj.errors);

            if (response.oauthApprovalUrl) {
                msg.createDismissibleMessage('OAuth URL:' + response.oauthApprovalUrl);
            } else if (oauthError) {
                msg.createDismissibleMessage('OAuth error: ' + response.oauthError + ': ' + response.oauthErrorText);
            }
            if (response.data || response.text) {
                msg.createDismissibleMessage(response.text);
            }
       };

      

       function makeCachedRequest(url, callback, params, refreshInterval) {
          var ts = new Date().getTime();
          var sep = "?";
          if (refreshInterval && refreshInterval > 0) {
            ts = Math.floor(ts / (refreshInterval * 1000));
          }
          if (url.indexOf("?") > -1) {
            sep = "&";
          }
          url = [ url, sep, "nocache=", ts ].join("");
          gadgets.io.makeRequest(url, callback, params);
       }
      

     </script>

    <FORM NAME="myform" ACTION="" METHOD="GET">Etiquette   Feedback for <BR>
       <INPUT TYPE="text" NAME="name" VALUE="prasanthn@flipkart.com"><P>
       <label for="listening">Listening Habits:</label>
       <select name="listening">
          <option value="good">Good</option>
          <option value="bad">Bad</option>
          <option value="ugly">Ugly</option>
       </select>
       <br/>
       <label for="punctuality">Punctuality:</label>
       <select name="punctuality">
          <option value="most_often_late">Most often late</option>
          <option value="sometimes_late">Sometimes late</option>
          <option value="prompt">Prompt</option>
       </select>
     </p>
       <INPUT TYPE="button" NAME="button" Value="Give Feedback" onClick="giveFeedback(this.form)">
     </FORM>
     <div id="content_div"></div>
     
  ]]>
  </Content>
</Module>