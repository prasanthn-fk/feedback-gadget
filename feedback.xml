<?xml version="1.0" encoding="UTF-8" ?>

<Module>
  <ModulePrefs title="Feedback1.0">
    <Require feature="minimessage"/> 
  </ModulePrefs>

  <Content type="html">
  <![CDATA[
     <script type="text/javascript">

       // The gadget version of ROT13.
       // Encodes/decodes text strings by replacing each letter with the letter
       // 13 positions to the right in the alphabet.

      
       function giveFeedback (form) {
          var recepient = form.name.value;
          var listening = form.listening.value
          var punctuality = form.punctuality.value
          var time = new Date();

          var msg = new gadgets.MiniMessage(__MODULE_ID__);
          

          var update = write_to_db(new Date(), recepient, listening, punctuality);
          msg.createDismissibleMessage("Your feedback on " + recepient + " has been noted. Thanks. " + update);

       }

       function write_to_db(time, recepient, listening, punctuality) {
          var DATA_SPREADSHEET_ID = "1S0-mhHH5DafeeBxBySB0d7E2qfxiiVILR4LLnatZ5ls";
          var dataSheet = SpreadsheetApp.openById(DATA_SPREADSHEET_ID).getSheets()[0];
          var values = [time, recepient, listening, punctuality];
          setRowsData(dataSheet, values);
       }


      function setRowsData(sheet, objects, optHeadersRange, optFirstDataRowIndex) {
          var headersRange = optHeadersRange || sheet.getRange(1, 1, 1, sheet.getMaxColumns());
          var firstDataRowIndex = optFirstDataRowIndex || sheet.getLastRow() + 1;
                  
          var data = [];
          data.push(objects);

          var destinationRange = sheet.getRange(firstDataRowIndex, 1, 1, 4);

          destinationRange.setValues(data);
      }

     </script>

    <FORM NAME="myform" ACTION="" METHOD="GET">Etiquette   Feedback for <BR>
       <INPUT TYPE="text" NAME="name" VALUE="prasanthn@flipkart.com"><P>
       <label for="listening">Listening Habits:</label>
       <select name="listening">
          <option value="good">Good</option>
          <option value="bad">Bad</option>
          <option value="ugly">Ugly</option>
       </select>
       <br/>
       <label for="punctuality">Punctuality:</label>
       <select name="punctuality">
          <option value="most_often_late">Most often late</option>
          <option value="sometimes_late">Sometimes late</option>
          <option value="prompt">Prompt</option>
       </select>
     </p>
       <INPUT TYPE="button" NAME="button" Value="Give Feedback" onClick="giveFeedback(this.form)">
     </FORM>
     <div id="content_div"></div>
  ]]>
  </Content>
</Module>